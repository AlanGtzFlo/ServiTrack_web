<div class="policy-detail-container" *ngIf="policy && !isEditing">
  <div class="section-header">
    <button class="btn-text back-button" (click)="goToPoliciesList()">
      <i class="material-icons">arrow_back</i> Volver a Pólizas
    </button>
    <h1 class="section-title">Póliza: #{{ policy.nombre }}</h1>
    <div class="header-actions">
      <button *ngIf="isAdmin" class="btn btn-secondary" (click)="editPolicy()">
        <i class="material-icons">edit</i> Editar
      </button>
      <button *ngIf="isAdmin" class="btn btn-delete" (click)="deletePolicy()">
        <i class="material-icons">delete</i> Eliminar
      </button>
    </div>
  </div>
  <div class="policy-detail-grid">
    <div class="info-panel card">
      <h2 class="panel-title">Información General</h2>
      <div class="info-group">
        <p class="label">Nombre:</p>
        <p class="value">{{ policy.nombre || 'No especificado' }}</p>
      </div>
      <div class="info-group">
        <p class="label">Tipo de Póliza:</p>
        <p class="value">{{ getTipoPolizaLabel(policy.tipo_poliza) }}</p>
      </div>
      <div class="info-group">
        <p class="label">Fecha de Inicio:</p>
        <p class="value">{{ (policy.fecha_inicio_poliza | date) || 'No especificado' }}</p>
      </div>
      <div class="info-group">
        <p class="label">Fecha de Fin:</p>
        <p class="value">{{ (policy.fecha_fin_poliza | date) || 'No especificado' }}</p>
      </div>
      <div class="info-group">
        <p class="label">Estatus:</p>
        <p class="value">
          <span class="status-badge" [ngClass]="{
            'status-success': policy.estatus === true,
            'status-error': policy.estatus === false
          }">
            {{ policy.estatus ? 'Vigente' : 'Vencida' }}
          </span>
        </p>
      </div>
    </div>
  </div>
</div>

<div class="policy-edit-container" *ngIf="policyToEdit && isEditing && isAdmin">
  <div class="section-header">
    <h1 class="section-title">Editando Póliza: #{{ policyToEdit.nombre }}</h1>
  </div>
  <div class="edit-policy-form card">
    <form #policyForm="ngForm" (ngSubmit)="saveChanges()">
      <div class="form-grid">
        <div class="form-group">
          <label for="nombre">Nombre</label>
          <input type="text" id="nombre" [(ngModel)]="policyToEdit.nombre" name="nombre" required>
        </div>

        <div class="form-group">
          <label for="tipo_poliza">Tipo de Póliza <span class="required">*</span></label>
          <select id="tipo_poliza" [(ngModel)]="policyToEdit.tipo_poliza" name="tipo_poliza" required>
            <option *ngFor="let tipo of tiposPoliza" [value]="tipo.value">{{ tipo.label }}</option>
          </select>
          <div *ngIf="policyForm.submitted && !policyForm.controls['tipo_poliza']?.valid" class="validation-error">
            El tipo de póliza es obligatorio.
          </div>
        </div>

        <div class="form-group">
          <label for="fecha_inicio_poliza">Fecha de Inicio</label>
          <input type="date" id="fecha_inicio_poliza" [(ngModel)]="policyToEdit.fecha_inicio_poliza" name="fecha_inicio_poliza" required>
        </div>

        <div class="form-group">
          <label for="fecha_fin_poliza">Fecha de Fin</label>
          <input type="date" id="fecha_fin_poliza" [(ngModel)]="policyToEdit.fecha_fin_poliza" name="fecha_fin_poliza" required>
        </div>

        <div class="form-group">
          <label for="estatus">Estatus</label>
          <select id="estatus" [(ngModel)]="policyToEdit.estatus" name="estatus" required>
            <option [ngValue]="true">Vigente</option>
            <option [ngValue]="false">Vencida</option>
          </select>
        </div>
      </div>

      <div class="form-actions" style="margin-top: 1rem;">
        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
        <button type="button" class="btn btn-secondary" (click)="cancelEditing()">Cancelar</button>
      </div>
    </form>
  </div>
</div>

<div *ngIf="!policy && !isEditing" class="loading-or-error">
  <p>Cargando información de la póliza o la póliza no fue encontrada...</p>
</div>
