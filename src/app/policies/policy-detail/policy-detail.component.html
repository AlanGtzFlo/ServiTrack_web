<div class="policy-detail-container" *ngIf="policy">
  <div class="section-header">
    <button class="btn-text back-button" (click)="goToPoliciesList()">
      <i class="material-icons">arrow_back</i> Volver a Pólizas
    </button>
    <h1 class="section-title">Póliza: #{{ policy.policyNumber }}</h1>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="editPolicy()">
        <i class="material-icons">edit</i> Editar
      </button>
      <button class="btn btn-delete" (click)="deletePolicy()">
        <i class="material-icons">delete</i> Eliminar
      </button>
    </div>
  </div>

  <div class="policy-detail-grid">
    <div class="info-panel card">
      <h2 class="panel-title">Información General</h2>
      <div class="info-group">
        <p class="label">Número de Póliza:</p>
        <p class="value">{{ policy.policyNumber }}</p>
      </div>
      <div class="info-group">
        <p class="label">Cliente:</p>
        <p class="value">
          <a [routerLink]="['/clients', policy.clientId]" class="client-link">
            {{ policy.clientName }} <i class="material-icons tiny-icon">open_in_new</i>
          </a>
        </p>
      </div>
      <div class="info-group">
        <p class="label">Tipo:</p>
        <p class="value">{{ policy.type }}</p>
      </div>
      <div class="info-group">
        <p class="label">Inicio Vigencia:</p>
        <p class="value">{{ policy.startDate }}</p>
      </div>
      <div class="info-group">
        <p class="label">Fin Vigencia:</p>
        <p class="value">{{ policy.endDate }}</p>
      </div>
      <div class="info-group">
        <p class="label">Estado:</p>
        <p class="value">
          <span class="status-badge" [ngClass]="{
            'status-success': policy.status === 'Vigente',
            'status-error': policy.status === 'Vencida',
            'status-pending': policy.status === 'Pendiente'
          }">
            {{ policy.status }}
          </span>
        </p>
      </div>
      <div class="info-group">
        <p class="label">Agente Asignado:</p>
        <p class="value">{{ policy.assignedAgent }}</p>
      </div>
      <div class="info-group description-group">
        <p class="label">Descripción:</p>
        <p class="value description-text">{{ policy.description }}</p>
      </div>
      <div class="info-group notes-group">
        <p class="label">Notas Internas:</p>
        <p class="value notes-text">{{ policy.notes || 'No hay notas adicionales para esta póliza.' }}</p>
      </div>
    </div>

    <div class="terms-coverage-panel card">
      <h2 class="panel-title">Términos y Cobertura</h2>
      <div class="info-group terms-group">
        <p class="label">Términos Clave:</p>
        <p class="value terms-text">{{ policy.terms || 'No hay términos detallados disponibles.' }}</p>
      </div>
      <div class="info-group covered-items-group">
        <p class="label">Elementos Cubiertos:</p>
        <ul class="covered-items-list" *ngIf="policy.coveredItems && policy.coveredItems.length > 0; else noCoveredItems">
          <li *ngFor="let item of policy.coveredItems">{{ item }}</li>
        </ul>
        <ng-template #noCoveredItems>
          <p class="value">No hay elementos cubiertos especificados.</p>
        </ng-template>
      </div>
    </div>

    <div class="documents-panel card">
      <h2 class="panel-title">Documentos Adjuntos ({{ documents.length }})</h2>
      <div class="no-data-message" *ngIf="documents.length === 0">
        <p>No hay documentos adjuntos para esta póliza.</p>
      </div>
      <div class="document-list" *ngIf="documents.length > 0">
        <div class="document-item" *ngFor="let doc of documents" (click)="downloadDocument(doc.url)">
          <i class="material-icons document-icon">
            {{ doc.type === 'PDF' ? 'picture_as_pdf' : (doc.type === 'DOCX' ? 'description' : 'image') }}
          </i>
          <div class="document-info">
            <p class="document-name">{{ doc.name }}</p>
            <span class="document-type">{{ doc.type }}</span>
          </div>
          <button class="btn-text download-button">Descargar <i class="material-icons tiny-icon">file_download</i></button>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!policy" class="loading-or-error">
  <p>Cargando información de la póliza o la póliza no fue encontrada...</p>
</div>