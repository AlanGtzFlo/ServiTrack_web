<div class="services-container">
  <div class="section-header">
    <h1 class="section-title">Gestión de Servicios y Tickets</h1>
    <div class="header-actions">
      <div class="search-box">
        <i class="material-icons search-icon">search</i>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          placeholder="Buscar por título, descripción, cliente o técnico..."
          class="search-input"
        />
      </div>

      <select [(ngModel)]="filterStatus" class="filter-dropdown">
        <option value="all">Todos los Estados</option>
        <option value="Pendiente">Pendiente</option>
        <option value="En Proceso">En Proceso</option>
        <option value="Completado">Completado</option>
        <option value="Cerrado">Cerrado</option>
      </select>

      <select [(ngModel)]="filterPriority" class="filter-dropdown">
        <option value="all">Todas las Prioridades</option>
        <option value="Urgente">Urgente</option>
        <option value="Alta">Alta</option>
        <option value="Media">Media</option>
        <option value="Baja">Baja</option>
      </select>

      <button class="btn btn-secondary" (click)="exportTicketsToPdf()">
        <i class="material-icons">picture_as_pdf</i> Exportar PDF
      </button>

      <button class="btn btn-primary" routerLink="/services/new">
        <i class="material-icons">add</i> Nuevo Servicio
      </button>
    </div>
  </div>

  <div class="services-grid">
    <div
      class="service-card card"
      *ngFor="let service of filteredServices"
      [routerLink]="['/services', service.id]"
    >
      <div class="card-header">
        <h3 class="service-title">{{ service.titulo }}</h3>
        <span class="service-status" [ngClass]="getStatusClass(service.estado)">
          {{ service.estado }}
        </span>
      </div>

      <div class="card-body">

        <p class="client-info" *ngIf="service.usuario_creador?.nombre">
          <i class="material-icons small-icon">business</i> Cliente:
          {{ service.usuario_creador?.nombre }}
        </p>
        <p class="service-meta">
          <i class="material-icons small-icon">category</i> Tipo: Correctivo
        </p>
        <p class="service-meta">
          <i class="material-icons small-icon">label_important</i> Prioridad:
          <span [ngClass]="getPriorityClass(service.prioridad)">{{
            service.prioridad
          }}</span>
        </p>
        <p class="service-meta" *ngIf="service.tecnico_asignado?.nombre">
          <i class="material-icons small-icon">build</i> Técnico:
          {{ service.tecnico_asignado?.nombre }}
        </p>
        <p class="service-meta" *ngIf="service.fecha_limite">
          <i class="material-icons small-icon">schedule</i> Límite:
          {{ service.fecha_limite }}
        </p>

      </div>

      <div class="card-footer">
        <a [routerLink]="['/services', service.id]" class="btn-text"
          >Ver Detalles</a
        >
      </div>
    </div>

    <div
      *ngIf="filteredServices.length === 0"
      class="no-results-message card"
    >
      <p>
        No se encontraron servicios que coincidan con la búsqueda o filtros
        aplicados.
      </p>
      <button
        *ngIf="searchTerm || filterStatus !== 'all' || filterPriority !== 'all'"
        class="btn-secondary"
        (click)="clearFilters()"
      >
        Limpiar Filtros
      </button>
    </div>
  </div>
</div>
